{"version":3,"sources":["index.js"],"names":["_request","require","_runtime","_interopRequireDefault","Page","data","MenuList","MenuDetail","currentIndex","scrollTop","CartData","wx","getStorageSync","onLoad","Date","now","time","this","getCartData","console","log","map","v","cat_name","children","res","async","_context","prev","next","awrap","request","url","sent","setStorageSync","setData","stop","handleMenuList","e","index","currentTarget","dataset"],"mappings":"aAAA,IAAAA,SAAAC,QAAA,4BACAC,SAAAC,uBAAAF,QAAA,sGADAG,KAAA,CAMEC,KAAM,CACJC,SAAU,GALVC,WAAC,GACHC,aAAA,EAOEC,UAAW,GAJbJ,SAAM,GAIJI,OAAAA,WAYA,IAAMC,EAAWC,GAAGC,eAAe,YANrCC,GAAMH,EAaF,GAAiC,IAA7BI,KAAKC,MAAQL,EAASM,KAL1BC,KAAAC,cACAC,QAAKD,IAAAA,gBACE,CAEPC,QAAAC,IAAA,WACAH,KAAIH,SAAaJ,EAASM,KACxBG,QAAAC,IAAAH,KAAAP,UACA,IAAAJ,EAAKY,KAALR,SAAAW,IAAA,SAAAC,GAAA,OAAAA,EAAAC,WAFFhB,EAIOU,KAAAP,SAAA,GAAAc,SAELL,KAAAA,QAAY,CACZb,SAAAA,EACAa,WAAAA,SAnBJF,KAAAC,cACAC,QAAAC,IAAA,QAqBIF,YAxCR,WAAA,IAAAO,EAAAnB,EAAAC,EAAA,OAAAL,SAAA,QAAAwB,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAAAF,EAAAE,KAAA,EAAA3B,SAAA,QAAA4B,OA4EI,EAAA9B,SAAA+B,SAAA,CAAAC,IAAA,iBA5EJ,KAAA,EA4EkCP,EA5ElCE,EAAAM,KA6EQ3B,KAAAA,SA3EHmB,EA2EgCd,GAAAuB,eAAQ,WAAR,CAAAlB,KAAAF,KAAAC,MAAAV,KAAAY,KAAAP,WAAAJ,EA3EhCW,KAAAP,SAAAW,IAAA,SAAAC,GAAA,OAAAA,EAAAC,WA4EGhB,EAAAA,KAAaG,SAAKA,GAALc,SACjBP,KAAAkB,QAAKA,CACH7B,SAAAA,EACAC,WAAAA,IAjFN,KAAA,EAAA,IAAA,MAAA,OAAAoB,EAAAS,SAAA,KAAAnB,OAEKoB,eAFL,SAEKC,GAAA,IAAAC,EAAAD,EAAAE,cAAAC,QAAAF,MAAAhC,EAAAU,KAAAP,SAAA6B,GAAAf,SAAAP,KAAAkB,QAAA,CAAA3B,aAAA+B,EAAAhC,WAAAA,EAAAE,UAAA","file":"index.min.js","sourcesContent":["import { request } from \"../../request/request.js\";\nimport regeneratorRuntime from \"../../lib/runtime/runtime\";\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    MenuList: [],\n    MenuDetail: [],\n    currentIndex: 0,\n    scrollTop: 0,\n  },\n  CartData: [],\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad: function (options) {\n    // this.getCartData();\n    //判断本地存储中有无旧数据 如果没有就发送新请求\n    // 如果有旧的数据 就判断是否过期 没有过期就使用\n\n    // 获取本地存储的数据\n    const CartData = wx.getStorageSync(\"cartData\");\n    if (!CartData) {\n      // 不存在 发送请求获取数据\n      this.getCartData();\n      console.log(\"不存在\");\n    } else {\n      // 有旧的数据 定义过期时间\n      if (Date.now() - CartData.time > 1000 * 10) {\n        // 重新发送请求\n        this.getCartData();\n        console.log(\"不能使用旧的数据\");\n      } else {\n        // 可以使用旧数据\n        console.log(\"可以使用旧数据\");\n        this.CartData = CartData.data;\n        console.log(this.CartData);\n        let MenuList = this.CartData.map((v) => v.cat_name);\n        // 右侧\n        let MenuDetail = this.CartData[0].children;\n\n        this.setData({\n          MenuList,\n          MenuDetail,\n        });\n      }\n    }\n  },\n  async getCartData() {\n    // request({\n    //   url: \"/categories\",\n    // }).then((res) => {\n    //   this.CartData = res.data.message;\n    //   // 在此处可以确定数据已经返回来了\n    //   // 把接口的数据存入到本地存储中\n    //   wx.setStorageSync(\"cartData\", { time: Date.now(), data: this.CartData });\n    //   // wx.getStorage({\n    //   //   key: \"cartData\",\n    //   //   success(res) {\n    //   //     console.log(res.data);\n    //   //   },\n    //   // });\n    //   // 把数据存储在\n    //   // 左侧菜单信息\n    //   let MenuList = this.CartData.map((v) => v.cat_name);\n    //   // 右侧\n    //   let MenuDetail = this.CartData[0].children;\n    //   this.setData({\n    //     MenuList,\n    //     MenuDetail,\n    //   });\n    // });\n    // 使用es7的async和await来发请求\n    const res = await request({ url: \"/categories\" });\n    this.CartData = res;\n    wx.setStorageSync(\"cartData\", { time: Date.now(), data: this.CartData });\n    let MenuList = this.CartData.map((v) => v.cat_name);\n    let MenuDetail = this.CartData[0].children;\n    this.setData({\n      MenuList,\n      MenuDetail,\n    });\n  },\n  handleMenuList(e) {\n    let { index } = e.currentTarget.dataset;\n    let MenuDetail = this.CartData[index].children;\n    this.setData({\n      currentIndex: index,\n      MenuDetail,\n      scrollTop: 0,\n    });\n\n    // 重新设置scrollView标签的距离顶部的距离： scrollTop\n  },\n});\n"]}